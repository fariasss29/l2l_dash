import axios from "axios";
import https from "https";

class GetL2LStatus {
  async execute() {
    const API_KEY = process.env.L2L_API_KEY || "lBfcswtYB4pQUEKLnBv39jxtA2doZRxV";
    const BASE_PRODUCTS_URL = "https://astemo-am.l2l.com/api/1.0/dispatchtypes/";
    const SITE_ID = 901;

    const agent = new https.Agent({ rejectUnauthorized: false, keepAlive: true });
    const http = axios.create({
      httpsAgent: agent,
      timeout: 60000,
      params: { auth: API_KEY, site: SITE_ID },
      maxRedirects: 0,
      decompress: true,
      validateStatus: (s) => s >= 200 && s < 300,
    });

    try {
      const response = await http.get(BASE_PRODUCTS_URL);
      return response.data;
      console.log('Dados recebidos da API externa:', response.data);
    } catch (error) {
      console.error('Erro ao buscar dados da API externa:', error.message);
      throw error;
    }
  }
}

export default GetL2LStatus;
